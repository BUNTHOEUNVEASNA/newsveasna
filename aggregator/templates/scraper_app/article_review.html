{% extends "scraper_app/base_admin.html" %}

{% block title %}Article Review & Search{% endblock %}
{% block page_title %}Article Review & Search{% endblock %}

{% block content %}
<!-- Styles for New Clean UI -->
<style>
    /* Page Wrap */
    .page-wrap {
        padding: 20px 10px;
        font-family: 'Inter', sans-serif;
        color: #333;
    }

    /* Card */
    .beautiful-card {
        background: #ffffff;
        border-radius: 14px;
        padding: 24px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.07);
        margin-top: 20px;
    }

    /* Section Header */
    .beautiful-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 18px;
    }

    .beautiful-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }

    /* Filters Grid */
    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 18px;
        margin-top: 15px;
    }

    .filter-item label {
        font-weight: 600;
        color: #555;
        margin-bottom: 6px;
        display: block;
        font-size: 14px;
    }

    .filter-item input,
    .filter-item select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background: #fff;
        font-size: 14px;
        transition: border 0.2s;
    }

    .filter-item input:focus,
    .filter-item select:focus {
        border-color: #6366f1;
        outline: none;
    }

    /* Primary Button */
    .btn-primary {
        background: #4f46e5;
        color: #fff;
        padding: 10px 18px;
        border-radius: 8px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn-primary:hover {
        background: #4338ca;
    }

    a.link-clear, a.link-edit {
        color: #4f46e5;
        font-weight: 500;
        text-decoration: none;
        margin-left: 10px;
    }

    a.link-clear:hover, a.link-edit:hover {
        text-decoration: underline;
    }

    /* Table */
    .beautiful-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
    }

    .beautiful-table thead {
        background: #f8f9ff;
    }

    .beautiful-table th {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.6px;
        color: #6b7280;
        padding: 14px;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
    }

    .beautiful-table td {
        padding: 14px;
        font-size: 15px;
        color: #374151;
        border-bottom: 1px solid #f0f0f0;
    }

    .beautiful-table tr:hover {
        background: #fafafa;
    }

    /* Source Badge */
    .source-badge {
        display: inline-block;
        padding: 6px 12px;
        background: #eef2ff;
        color: #4f46e5;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
    }

    .empty-row {
        text-align: center;
        padding: 20px;
        color: #9ca3af;
        font-style: italic;
    }

    /* Footer */
    .page-footer {
        text-align: center;
        margin-top: 30px;
        color: #9ca3af;
        font-size: 0.9rem;
    }
    
    .action-btn {
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 500;
        text-decoration: none;
        cursor: pointer;
        transition: 0.2s;
        border: none;
        display: inline-block;
    }

    .edit-btn {
        background-color: #4f46e5;
        color: #fff;
    }

    .edit-btn:hover {
        background-color: #4338ca;
    }

    .delete-btn {
        background-color: #f87171;
        color: #fff;
    }

    .delete-btn:hover {
        background-color: #dc2626;
    }

    .beautiful-table td form {
        margin: 0; /* remove default spacing */
    }
</style>


<div class="page-wrap">

    <!-- FILTERS CARD -->
    <section class="beautiful-card">
        <div class="beautiful-header">
            <div class="beautiful-title">Advanced Filters</div>
        </div>

        <form method="GET" action="{% url 'article_review' %}">
            <div class="filter-grid">

                <!-- Source dropdown -->
                <div class="filter-item">
                    <label for="source">Source</label>
                    <select id="source" name="source">
                        <option value="">All Sources</option>
                        {% for source in all_sources %}
                        <option value="{{ source.id }}" 
                                {% if source.id|stringformat:"s" == selected_source_id %}selected{% endif %}>
                            {{ source.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Keyword -->
                <div class="filter-item">
                    <label for="keyword">Keyword Search</label>
                    <input type="text" id="keyword" name="keyword" 
                           value="{{ keyword }}" placeholder="Search titles or content...">
                </div>

                <!-- Submit -->
                <div class="filter-item" style="display:flex; align-items:center; gap:10px;">
                    <button type="submit" class="btn-primary">Apply Filters</button>

                    {% if selected_source_id or keyword or filter_incomplete %}
                        <a href="{% url 'article_review' %}" class="link-clear">Clear Filters</a>
                    {% endif %}
                </div>
            </div>
        </form>
    </section>


    <!-- RESULTS TABLE CARD -->
   <!-- RESULTS TABLE CARD -->
<section class="beautiful-card">
    <div class="beautiful-header">
        <div class="beautiful-title">Results: {{ articles|length }} Articles Found</div>
    </div>

    <table class="beautiful-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Source</th>
                <th>Scrape Date</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for article in articles %}
            <tr>
                <td>
                    <a href="{{ article.url }}" target="_blank"
                       style="color:#2563eb; text-decoration:none;">
                       {{ article.title|truncatechars:60 }}
                    </a>
                </td>

                <td><span class="source-badge">{{ article.source.name }}</span></td>

                <td>{{ article.timestamp|date:"m/d/Y H:i" }}</td>

                <td style="display:flex; gap:8px; align-items:center;">

    <!-- Edit Button -->
    <a href="{% url 'edit_article' article.pk %}" 
       class="action-btn edit-btn">
       Edit
    </a>

    <!-- Delete Button -->
    <form method="POST" action="{% url 'delete_article' article.pk %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="action-btn delete-btn" 
                onclick="return confirm('Are you sure you want to delete this article?');">
            Delete
        </button>
    </form>

</td>
            </tr>

            {% empty %}
            <tr>
                <td colspan="4" class="empty-row">No articles found matching filters.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>


    <div class="page-footer">
        © {{ now|date:"Y" }} Aggregator Studio — Designed for Efficiency
    </div>

</div>
{% endblock %}
